(()=>{"use strict";const e=e=>{const t=JSON.parse(localStorage.getItem("users"))||[],n=[];return t.length>0&&(t.forEach(((t,a)=>{n.push(new e(a,t.email,t.password,t.dateReg,t.permissions,t.auth))})),localStorage.setItem("users",JSON.stringify(n))),n},t=()=>{const e=JSON.parse(localStorage.getItem("users"))||[];let t=JSON.parse(localStorage.getItem("auth"))||[];const n=document.getElementById("text-email"),a=document.getElementById("text-date"),l=document.querySelector("tbody"),i=document.getElementById("popup"),o=document.querySelector(".popup__content"),r=document.getElementById("popup_close"),s=document.getElementById("popup__email"),d=document.getElementById("popup__password"),c=document.getElementById("popup__password-check");let u=document.getElementById("popup__btn-save");const m=document.getElementById("popup__email-err"),h=document.getElementById("popup__password-err"),p=document.getElementById("text-err"),g=document.querySelector(".perm");let y,v;return class{constructor(e,t,n,a,l="user",i=""){this.index=e,this.email=t,this.password=n,this.dateReg=a,this.permissions=l,this.auth=i}start(){this.show(),this.auth&&(l.addEventListener("click",(e=>{e.target.matches(".btn")&&(y=+e.target.id,this.openChange(e))})),u.addEventListener("click",this.change.bind(this)),r.addEventListener("click",this.closeChange.bind(this)),c.addEventListener("input",this.checkPass.bind(this)),d.addEventListener("input",this.checkPass.bind(this)))}show(){this.auth&&(n.innerText=this.email,a.innerText=this.dateReg),l.insertAdjacentHTML("beforeend",`<tr>\n        <td>${this.index+1}</td>\n        <td class="e${this.index}">${this.email}</td>\n        <td>${"admin"===t[1]||this.auth?`<button class="btn" id="${this.index}">Редактировать данные</button>`:""}</td>\n        </tr>`)}openChange(n){n.preventDefault();let a=0;this.animPopup=()=>{const e=requestAnimationFrame(this.animPopup);a+=.03,o.style.opacity=`${a}`,a>=1&&cancelAnimationFrame(e)},o.style.opacity="0",s.value="",d.value="",c.value="",s.placeholder="Введите новый email",d.placeholder="Введите новый пароль",c.placeholder="Повторите пароль",m.innerText="",h.innerText="",p.innerText="",g.value=e[`${n.target.id}`].permissions,g.style.display="none","admin"===t[1]&&e[`${n.target.id}`].email!==t[0]&&(g.style.display="inline-block"),i.style.zIndex="3",i.style.visibility="visible",this.animPopup()}closeChange(e){e.preventDefault(),i.style.zIndex="1",i.style.visibility="hidden"}checkPass(e){this.check=(t,n)=>{e.target===t&&(t.value!==n.value&&n.value.length>0?p.innerText="Пароли не совпадают":p.innerText="")},this.check(c,d),this.check(d,c)}change(a){a.preventDefault();let l=!0,o=!0,r=!0;""!==s.value.trim()&&(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(s.value.trim())||(l=!1,m.innerText="Введите корректный eMail"),e.forEach((e=>{e.index!==y&&e.email===s.value.trim()&&(l=!1,alert("Пользователь с таким eMail уже зарегистрирован!"))}))),""!==d.value&&d.value.length<6&&(l=!1,h.innerText="Пароль должен содержать не менее 6 символов!"),l&&(o&&""!==s.value.trim()&&(e.forEach((e=>{e.index===y&&(e.email=s.value,e.auth&&(t[0]=s.value))})),o=!1),r&&""!==d.value&&(d.value===c.value?(e.forEach((e=>{e.index===y&&(e.password=d.value)})),r=!1):p.innerText="Пароли не совпадают"),e.forEach((e=>{e.index===y&&(v=e.permissions,g.value!==e.permissions&&(e.permissions=g.value,alert("Права успешно изменены!")))})),""===s.value.trim()&&""===d.value&&g.value===v||(i.style.zIndex="1",i.style.visibility="hidden",localStorage.setItem("users",JSON.stringify(e)),localStorage.setItem("auth",JSON.stringify(t))),o||(alert("EMail успешно изменен!"),n.innerText=t[0],document.querySelector(`.e${y}`).innerText=e[y].email),r||alert("Пароль успешно изменен!"))}}};(()=>{const n=e(t())||[],a=t(),l=new Date,i=`${l.toLocaleDateString("ru")} в ${l.toLocaleTimeString("ru")}`;0===n.length&&n.push(new a(0,"admin@mail.ru","admin",i,"admin")),localStorage.setItem("users",JSON.stringify(n))})(),(()=>{const e=window.location.href.slice(0,window.location.href.lastIndexOf("/")),t=e+"/index.html",n=e+"/home.html";let a=JSON.parse(localStorage.getItem("auth"))||[];const l=document.querySelector(".container-index"),i=document.querySelector(".container-home");l&&a.length>0&&window.location.replace(n),i&&0===a.length&&window.location.replace(t)})(),(()=>{const e=document.querySelector(".container-home"),t=(e,t)=>{e.addEventListener("focus",(()=>{const n=e.placeholder;e.placeholder="",t.innerText="",e.addEventListener("blur",(()=>{e.placeholder=n}))}))};if(document.querySelector(".container-index")){const e=document.getElementById("email"),n=document.getElementById("email-err"),a=document.getElementById("password"),l=document.getElementById("password-err");t(e,n),t(a,l)}if(e){const e=document.getElementById("popup__email"),n=document.getElementById("popup__password"),a=document.getElementById("popup__password-check"),l=document.getElementById("popup__email-err"),i=document.getElementById("popup__password-err"),o=document.getElementById("text-err");t(e,l),t(n,i),t(a,o)}})(),document.querySelector(".container-index")&&((n=>{const a=document.getElementById("btn-reg"),l=document.getElementById("email"),i=document.getElementById("email-err"),o=document.getElementById("password"),r=document.getElementById("password-err");a.addEventListener("click",(a=>{a.preventDefault();const s=e(t())||[];let d=!0;if(""!==l.value.trim()?(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(l.value.trim())||(d=!1,i.innerText="Введите корректный eMail"),s.length>0&&s.forEach((e=>{e.email===l.value.trim()&&(d=!1,alert("Пользователь с таким eMail уже зарегистрирован!"))}))):(d=!1,i.innerText="Введите eMail",l.value=""),""!==o.value?o.value.length<6&&(d=!1,r.innerText="Пароль должен содержать не менее 6 символов!"):(d=!1,r.innerText="Введите пароль"),d){const e=new Date,t=`${e.toLocaleDateString("ru")} в ${e.toLocaleTimeString("ru")}`,a=s.length;s.push(new n(a,l.value,o.value,t,"user")),l.value="",o.value="",alert("Вы успешно зарегистрировались"),localStorage.setItem("users",JSON.stringify(s))}}))})(t()),(()=>{const n=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/home.html",a=JSON.parse(localStorage.getItem("auth"))||[],l=document.getElementById("btn-auth"),i=document.getElementById("email"),o=document.getElementById("email-err"),r=document.getElementById("password"),s=document.getElementById("password-err");l.addEventListener("click",(l=>{l.preventDefault();const d=e(t())||[];let c=!0;""!==i.value.trim()?/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(i.value.trim())||(c=!1,o.innerText="Введите корректный eMail"):(c=!1,o.innerText="Введите eMail",i.value=""),""===r.value&&(c=!1,s.innerText="Введите пароль"),c&&(d.length>0?(d.forEach((e=>{e.email===i.value.trim()&&(c=!1,e.password===r.value?(e.auth="1",a.push(e.email),a.push(e.permissions),localStorage.setItem("auth",JSON.stringify(a)),localStorage.setItem("users",JSON.stringify(d)),window.location.href=n):(r.value="",alert("Вы ввели неверный пароль! Попробуйте снова!")))})),c&&alert("Пользователя с таким eMail не существует! Зарегистрируйтесь!")):alert("Пользователя с таким eMail не существует! Зарегистрируйтесь!"))}))})()),(()=>{const n=document.querySelector(".container-home"),a=e(t())||[];n&&(a.forEach((e=>{e.start()})),(()=>{const n=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/index.html";document.getElementById("btn-exit").addEventListener("click",(a=>{a.preventDefault();const l=e(t())||[];l.forEach((e=>{e.auth&&(e.auth="",localStorage.setItem("users",JSON.stringify(l)),localStorage.setItem("auth",JSON.stringify("")),window.location.href=n)}))}))})())})()})();