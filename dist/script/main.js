(()=>{"use strict";const e=e=>{const t=JSON.parse(localStorage.getItem("users"))||[],n=[];return t.length>0&&(t.forEach(((t,a)=>{n.push(new e(a,t.email,t.password,t.dateReg,t.auth))})),localStorage.setItem("users",JSON.stringify(n))),n},t=()=>{const e=JSON.parse(localStorage.getItem("users"))||[];let t=JSON.parse(localStorage.getItem("auth"))||"";const n=document.getElementById("text-email"),a=document.getElementById("text-date"),l=document.querySelector("tbody"),i=document.getElementById("popup"),o=document.querySelector(".popup__content"),r=document.getElementById("popup_close"),s=document.getElementById("popup__email"),c=document.getElementById("popup__password"),d=document.getElementById("popup__password-check");let u=document.getElementById("popup__btn-save");const m=document.getElementById("popup__email-err"),h=document.getElementById("popup__password-err"),p=document.getElementById("text-err");return class{constructor(e,t,n,a,l=""){this.index=e,this.email=t,this.password=n,this.dateReg=a,this.auth=l}start(){this.show(),this.auth&&(l.querySelector("#btn-cahge").addEventListener("click",this.openChange.bind(this)),r.addEventListener("click",this.closeChange.bind(this)),u.addEventListener("click",this.change.bind(this)),d.addEventListener("input",this.checkPass.bind(this)),c.addEventListener("input",this.checkPass.bind(this)))}show(){this.auth&&(n.innerText=this.email,a.innerText=this.dateReg),l.insertAdjacentHTML("beforeend",`<tr>\n      <td>${this.index+1}</td>\n      <td>${this.email}</td>\n      <td>${this.auth?'<button class="btn" id="btn-cahge">Редактировать данные</button>':""}</td>\n      </tr>`)}openChange(e){e.preventDefault();let t=0;this.animPopup=()=>{const e=requestAnimationFrame(this.animPopup);t+=.03,o.style.opacity=`${t}`,t>=1&&cancelAnimationFrame(e)},o.style.opacity="0",s.value="",c.value="",d.value="",s.placeholder="Введите новый email",c.placeholder="Введите новый пароль",d.placeholder="Повторите пароль",m.innerText="",h.innerText="",p.innerText="",i.style.zIndex="3",i.style.visibility="visible",this.animPopup(0)}closeChange(e){e.preventDefault(),i.style.zIndex="1",i.style.visibility="hidden"}checkPass(e){this.check=(t,n)=>{e.target===t&&(t.value!==n.value&&n.value.length>0?p.innerText="Пароли не совпадают":p.innerText="")},this.check(d,c),this.check(c,d)}change(a){a.preventDefault();let o=!0,r=!0,u=!0;""!==s.value.trim()&&(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(s.value.trim())||(o=!1,m.innerText="Введите корректный eMail"),e.forEach((e=>{e.email!==t&&e.email===s.value.trim()&&(o=!1,alert("Пользователь с таким eMail уже зарегистрирован!"))}))),""!==c.value&&c.value.length<6&&(o=!1,h.innerText="Пароль должен содержать не менее 6 символов!"),o&&(r&&""!==s.value.trim()&&(e.forEach((e=>{e.email===t&&(e.email=s.value)})),t=s.value,r=!1),u&&""!==c.value&&(c.value===d.value?(e.forEach((e=>{e.email===t&&(e.password=c.value)})),u=!1):p.innerText="Пароли не совпадают"),""===s.value.trim()&&""===c.value||(i.style.zIndex="1",i.style.visibility="hidden",localStorage.setItem("users",JSON.stringify(e)),localStorage.setItem("auth",JSON.stringify(t))),r||(alert("EMail успешно изменен!"),n.innerText=t,l.innerHTML='<tr><th>№ п/п</th><th>E-Mail</th><th class="td-btn">Редактирование</th></tr>',e.forEach((e=>{l.insertAdjacentHTML("beforeend",`<tr>\n            <td>${e.index+1}</td>\n            <td>${e.email}</td>\n            <td>${e.auth?'<button class="btn" id="btn-cahge">Редактировать данные</button>':""}</td>\n            </tr>`)})),l.querySelector("#btn-cahge").addEventListener("click",this.openChange.bind(this))),u||alert("Пароль успешно изменен!"))}}};(()=>{const e=window.location.href.slice(0,window.location.href.lastIndexOf("/")),t=e+"/index.html",n=e+"/home.html";let a=JSON.parse(localStorage.getItem("auth"))||"";const l=document.querySelector(".container-index"),i=document.querySelector(".container-home");l&&""!==a&&window.location.replace(n),i&&""===a&&window.location.replace(t)})(),(()=>{const e=document.querySelector(".container-home"),t=(e,t)=>{e.addEventListener("focus",(()=>{const n=e.placeholder;e.placeholder="",t.innerText="",e.addEventListener("blur",(()=>{e.placeholder=n}))}))};if(document.querySelector(".container-index")){const e=document.getElementById("email"),n=document.getElementById("email-err"),a=document.getElementById("password"),l=document.getElementById("password-err");t(e,n),t(a,l)}if(e){const e=document.getElementById("popup__email"),n=document.getElementById("popup__password"),a=document.getElementById("popup__password-check"),l=document.getElementById("popup__email-err"),i=document.getElementById("popup__password-err"),o=document.getElementById("text-err");t(e,l),t(n,i),t(a,o)}})(),document.querySelector(".container-index")&&((n=>{const a=document.getElementById("btn-reg"),l=document.getElementById("email"),i=document.getElementById("email-err"),o=document.getElementById("password"),r=document.getElementById("password-err");a.addEventListener("click",(a=>{a.preventDefault();const s=e(t())||[];let c=!0;if(""!==l.value.trim()?(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(l.value.trim())||(c=!1,i.innerText="Введите корректный eMail"),s.length>0&&s.forEach((e=>{e.email===l.value.trim()&&(c=!1,alert("Пользователь с таким eMail уже зарегистрирован!"))}))):(c=!1,i.innerText="Введите eMail",l.value=""),""!==o.value?o.value.length<6&&(c=!1,r.innerText="Пароль должен содержать не менее 6 символов!"):(c=!1,r.innerText="Введите пароль"),c){const e=new Date,t=`${e.toLocaleDateString("ru")} в ${e.toLocaleTimeString("ru")}`,a=s.length;s.push(new n(a,l.value,o.value,t)),l.value="",o.value="",alert("Вы успешно зарегистрировались"),localStorage.setItem("users",JSON.stringify(s))}}))})(t()),(()=>{const n=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/home.html",a=document.getElementById("btn-auth"),l=document.getElementById("email"),i=document.getElementById("email-err"),o=document.getElementById("password"),r=document.getElementById("password-err");a.addEventListener("click",(a=>{a.preventDefault();const s=e(t())||[];let c=!0;""!==l.value.trim()?/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(l.value.trim())||(c=!1,i.innerText="Введите корректный eMail"):(c=!1,i.innerText="Введите eMail",l.value=""),""===o.value&&(c=!1,r.innerText="Введите пароль"),c&&(s.length>0?(s.forEach((e=>{e.email===l.value.trim()&&(c=!1,e.password===o.value?(e.auth="1",localStorage.setItem("auth",JSON.stringify(e.email)),localStorage.setItem("users",JSON.stringify(s)),window.location.href=n):(o.value="",alert("Вы ввели неверный пароль! Попробуйте снова!")))})),c&&alert("Пользователя с таким eMail не существует! Зарегистрируйтесь!")):alert("Пользователя с таким eMail не существует! Зарегистрируйтесь!"))}))})()),document.querySelector(".container-home")&&((()=>{const n=document.querySelector(".container-home"),a=document.querySelector("tbody"),l=e(t())||[];n&&(a.innerHTML='<tr><th>№ п/п</th><th>E-Mail</th><th class="td-btn">Редактирование</th></tr>',l.forEach((e=>{e.start()})))})(),(()=>{const n=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/index.html";document.getElementById("btn-exit").addEventListener("click",(a=>{a.preventDefault();const l=e(t())||[];l.forEach((e=>{e.auth&&(e.auth="",localStorage.setItem("users",JSON.stringify(l)),localStorage.setItem("auth",JSON.stringify("")),window.location.href=n)}))}))})())})();